<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>No Lag Web App</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

.page {
    width: 100vw;
    height: 100vh;
    display: none;
    position: relative;
}

/* PAGE 1 */
#page1 {
    background: url("1.png") center / cover no-repeat;
}

#dragArea {
    position: absolute;
    bottom: 20vh;
    left: 50%;
    transform: translateX(-50%);
    width: 80vw;
    height: 10vh;
}

#dragBtn {
    position: absolute;
    top: 60%;
    left: 0;
    height: 70%;
    transform: translateY(-50%);
    touch-action: none;
}

/* PAGE 2 */
#bgVideo {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

#buttonBox {
    position: absolute;
    bottom: 15vh;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    gap: 3vh;
    z-index: 2;
}

.img-btn {
    width: 70vw;
    height: 12vw;
    opacity: 0;
    transition: opacity 0.6s ease;
}

/* FULL VIDEO */
#videoPage {
    background: black;
}

#videoPlayer {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* PAGE 3 */
#page3 {
    background: url("9.png") center / cover no-repeat;
}
</style>
</head>

<body>

<!-- PAGE 1 -->
<div id="page1" class="page">
    <div id="dragArea">
        <img src="2.png" id="dragBtn">
    </div>
</div>

<!-- PAGE 2 -->
<div id="page2" class="page">
    <video id="bgVideo"
        loop
        muted
        playsinline
        preload="auto">
        <source src="1.mp4" type="video/mp4">
    </video>

    <div id="buttonBox">
        <img src="3.png" class="img-btn" onclick="playVideo('1.mp4')">
        <img src="4.png" class="img-btn" onclick="playVideo('E.mp4')">
        <img src="5.png" class="img-btn" onclick="playVideo('1.mp4')">
    </div>
</div>

<!-- FULL VIDEO PAGE -->
<div id="videoPage" class="page">
    <video id="videoPlayer" playsinline preload="auto"></video>
</div>

<!-- PAGE 3 -->
<div id="page3" class="page"></div>

<script>
/* PRELOAD IMAGES */
["1.png","2.png","3.png","4.png","5.png","9.png"].forEach(src=>{
    const img = new Image();
    img.src = src;
});

/* ELEMENTS */
const page1 = document.getElementById("page1");
const page2 = document.getElementById("page2");
const page3 = document.getElementById("page3");
const videoPage = document.getElementById("videoPage");

const bgVideo = document.getElementById("bgVideo");
const videoPlayer = document.getElementById("videoPlayer");

page1.style.display = "block";

/* DRAG LOGIC */
const dragBtn = document.getElementById("dragBtn");
const dragArea = document.getElementById("dragArea");

let dragging = false;

dragBtn.addEventListener("mousedown", startDrag);
dragBtn.addEventListener("touchstart", startDrag, { passive:false });

document.addEventListener("mousemove", onMove);
document.addEventListener("touchmove", onMove, { passive:false });

document.addEventListener("mouseup", stopDrag);
document.addEventListener("touchend", stopDrag);

function startDrag(e){
    dragging = true;
    e.preventDefault();
}

function onMove(e){
    if(!dragging) return;

    const x = e.touches ? e.touches[0].clientX : e.clientX;
    const rect = dragArea.getBoundingClientRect();

    let percent = Math.min(1, Math.max(0, (x - rect.left) / rect.width));
    dragBtn.style.left =
        percent * (rect.width - dragBtn.offsetWidth) + "px";
}

function stopDrag(){
    if(!dragging) return;
    dragging = false;

    const rect = dragArea.getBoundingClientRect();
    const percent =
        dragBtn.offsetLeft / (rect.width - dragBtn.offsetWidth);

    if(percent > 0.95){
        openPage2();   // âœ… USER RELEASE = sound allowed
    } else {
        dragBtn.style.left = "0px"; // snap back
    }
}

/* PAGE 2 VIDEO WITH SOUND */
function openPage2(){
    page1.style.display = "none";
    page2.style.display = "block";

    bgVideo.pause();
    bgVideo.currentTime = 0;

    // ðŸ”‘ Enable sound AFTER user release
    bgVideo.muted = false;

    bgVideo.play().catch(err=>{
        console.log("Play blocked:", err);
    });

    document.querySelectorAll(".img-btn").forEach((b,i)=>{
        setTimeout(()=>b.style.opacity = 1, i * 400);
    });
}

/* FULL VIDEO PLAY */
function playVideo(src){
    bgVideo.pause();

    page2.style.display = "none";
    videoPage.style.display = "block";

    videoPlayer.pause();
    videoPlayer.src = src;
    videoPlayer.currentTime = 0;
    videoPlayer.muted = false;

    videoPlayer.play().catch(()=>{});
}

videoPlayer.onended = ()=>{
    videoPage.style.display = "none";
    page3.style.display = "block";
};
</script>

</body>
</html>
